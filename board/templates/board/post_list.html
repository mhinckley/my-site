{% extends 'board/base.html' %}

{% block content %}

    {% for post in posts %}
        <div class="parent_1 post{{ post.pk }}">

            <div class="vote">
              {% if user.is_authenticated %}
                  {% if post in liked_posts %}
                    <button type="button" class="btn btn-default-sm btn-selected unlike" name="{{ post.id }}" value="Like" />
                        <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> <span class="like_count">{{ post.total_likes }}</span>
                    </button>
                  {% else %}
                    <button type="button" class="btn btn-default-sm like" name="{{ post.id }}" value="Like" />
                        <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> <span class="like_count">{{ post.total_likes }}</span>
                    </button>
                  {% endif %}
              {% else %}
                    <a href="{% url 'register' %}" style="color: gray;">
                      <button type="button" class="btn btn-default-sm like" name="{{ post.id }}" />
                        <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> <span class="like_count">{{ post.total_likes }}</span>
                      </button>
                    </a>
              {% endif %}

            </div>
            <div class="post">
                <h3>To <a href="{% url 'to_posts' to_field=post.to_field %}" class="to">{{ post.to_field }}</a>, you can <a href="{% url 'post_detail' pk=post.pk %}" class="do">{{ post.do_field }}</a>.</h3>
                <p class="sub">Class: <a href="{% url 'contributor_posts' contributor=post.contributor %}"> {{ post.contributor }}</a> // Topics: <a>#influence</a>, <a>#persuasion</a>, <a>#hardpower</a></p>

                <!--<p class="sub">{{ post.published_date|date:"F n, Y" }}</p>-->
                <p class="sub">Remind me:  
                    <button type="button" class="btn btn-default-sm daily daily-btn follow-button" name="{{ post.id }}" value="1">
                      Daily <span class="daily_count">{{ post.total_daily }}</span>
                    </button>
                    <button type="button" class="btn btn-default-sm daily daily-btn follow-button" name="{{ post.id }}" value="3">
                      Weekly <span class="weekly_count">{{ post.total_weekly }}</span>
                    </button>
                    <button type="button" class="btn btn-default-sm daily daily-btn follow-button" name="{{ post.id }}" value="6">
                      Monthly <span class="monthly_count">{{ post.total_monthly }}</span>
                    </button>
                </p>
            
            </div>
        </div>
    {% endfor %}

    {% if posts.has_other_pages %}
        <div id="outer-pages">
            <nav aria-label="Page navigation" id="inner-pages">
              <ul class="pagination">
                <li class="page-item">
                {% if posts.has_previous %}
                  <a class="page-link" href="?page={{ posts.previous_page_number }}" aria-label="Previous">
                {% else %}
                  <a class="page-link" id="dead-link" aria-label="Previous">
                {% endif %}
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                  </a>
                </li>
                <li class="page-item"><a class="page-link" id="dead-link">Page {{ posts.number }} of {{ posts.paginator.num_pages }}</a></li>
                <li class="page-item">
                {% if posts.has_next %}
                  <a class="page-link" href="?page={{ posts.next_page_number }}" aria-label="Previous">
                {% else %}
                  <a class="page-link" aria-label="Next" id="dead-link">
                {% endif %}
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                  </a>
                </li>
              </ul>
            </nav>
        </div>
    {% endif %}


            <script> 
              $('.unlike').click(function(){
                var pk = $(this).attr('name');
                $.ajax({
                         type: "POST",
                         url: "{% url 'like_button' %}",
                         data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                         dataType: "json",
                         success: function(response) {
                                console.log('Post likes count is now ' + response.likes_count);
                                $('.post' + pk + ' .like_count').html(response.likes_count);
                                $('.post' + pk + ' .glyphicon').css('color', 'gray');
                                $('.post' + pk + ' .like_count').css('color', 'gray');
                                $('.post' + pk + ' .unlike').css('border-color', 'gray');
                                $('.post' + pk + ' .unlike').css('background', 'white');
                                console.log('This is unlike.');

                          },
                         error: function(response, e) {
                                console.log('Something went wrong.');
                         }
                    });
                })
              </script>

                <script>
                $('.like').click(function(){
                  var pk = $(this).attr('name');
                  $.ajax({
                           type: "POST",
                           url: "{% url 'like_button' %}",
                           data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                           dataType: "json",
                           success: function(response) {
                                  console.log('Post likes count is now ' + response.likes_count);
                                  $('.post' + pk + ' .like_count').html(response.likes_count);
                                  $('.post' + pk + ' .glyphicon').css('color', 'white');
                                  $('.post' + pk + ' .like_count').css('color', 'white');
                                  $('.post' + pk + ' .like').css('border-color', 'gray');
                                  $('.post' + pk + ' .like').css('background', 'gray');
                                  console.log('this is like.');
                            },
                           error: function(response, e) {
                                  console.log('Something went wrong.');
                           }
                      });
                  })

                  $('.follow-button').click(function(){
                    var pk = $(this).attr('name');
                    $.ajax({
                             type: "POST",
                             url: "{% url 'daily_button' %}",
                             data: {
                                 'pk': pk,
                                 'frequency': $(this).val().toLowerCase(),
                                 'csrfmiddlewaretoken': '{{ csrf_token }}'
                               },
                             dataType: "json",
                             success: function(response) {
                                    $('.post' + pk + ' .daily_count').html(response.total_daily);
                                    $('.post' + pk + ' .weekly_count').html(response.total_weekly);
                                    $('.post' + pk + ' .monthly_count').html(response.total_monthly);
                                    $('.post' + pk + ' .all_count').html(response.all_count);
                              },
                             error: function(response, e) {
                                    console.log('Something went wrong.');
                             }
                        });
                    })
                </script>


{% endblock %}


